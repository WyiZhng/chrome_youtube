# YouTube AI 扩展 - 安装和使用说明

## 🎉 已完成的更新

### ✅ 修复的问题
1. **OpenAI API 密钥验证** - 添加了 API 密钥验证和错误提示
2. **模型版本更新** - 更新到最新的 GPT 模型
3. **错误处理改进** - 提供更详细的错误信息，方便调试
4. **浏览器兼容性** - 添加了 `dangerouslyAllowBrowser: true` 以支持浏览器环境

### 🆕 更新的模型列表
- **GPT-4o Mini** (默认) - 最快、最便宜
- **GPT-4o** - 最新旗舰模型
- **GPT-4 Turbo** - 强大的模型
- **GPT-3.5 Turbo** - 经典模型

## 📦 安装步骤

### 1. 构建扩展
已经完成构建，输出在 `build/chrome-mv3-prod` 目录

### 2. 加载到 Chrome

1. 打开 Chrome 浏览器
2. 访问 `chrome://extensions/`
3. 在右上角启用 **开发者模式**
4. 点击 **加载已解压的扩展程序**
5. 选择目录：
   ```
   F:\engine_BT\youtube-ai-extension-main\build\chrome-mv3-prod
   ```

## 🔑 配置 OpenAI API 密钥

### 获取 API 密钥

1. 访问 [OpenAI Platform](https://platform.openai.com/api-keys)
2. 登录你的账号
3. 点击 **Create new secret key**
4. 复制生成的密钥（格式：`sk-proj-...`）

### 在扩展中设置密钥

1. 打开任意 YouTube 视频
2. 扩展图标会出现在页面右侧
3. 第一次使用时会提示输入 API 密钥
4. 粘贴你的 OpenAI API 密钥
5. 点击提交

**重要提示：**
- API 密钥存储在本地浏览器中
- 不会上传到任何服务器
- 只用于直接调用 OpenAI API

## 🎮 使用方法

### 功能 1: 视频摘要
1. 打开 YouTube 视频
2. 点击扩展面板中的 **Summary** 标签
3. 选择摘要模板（默认或自定义）
4. 选择 AI 模型
5. 点击 **Generate Summary**

### 功能 2: 视频聊天
1. 打开 YouTube 视频
2. 点击扩展面板中的 **Chat** 标签
3. 在输入框中输入问题
4. AI 会基于视频内容回答

### 功能 3: 查看字幕
1. 打开 YouTube 视频
2. 点击扩展面板中的 **Transcript** 标签
3. 查看完整的视频字幕

## 🐛 故障排除

### 问题：扩展无法加载
**解决方案：**
- 确保选择了正确的目录：`build/chrome-mv3-prod`
- 检查是否启用了开发者模式
- 尝试点击扩展页面的刷新图标

### 问题：无法发送对话/没有收到回复
**解决方案：**
1. **检查 API 密钥**
   - 打开浏览器控制台（F12）
   - 查看是否有 "OpenAI API key is required" 错误
   - 确保 API 密钥格式正确（以 `sk-` 开头）

2. **检查 API 额度**
   - 访问 [OpenAI Usage](https://platform.openai.com/usage)
   - 确认你的账户有可用额度
   - 检查是否设置了支付方式

3. **查看控制台日志**
   - 按 F12 打开开发者工具
   - 切换到 Console 标签
   - 查找错误信息（红色文字）
   - 常见错误：
     - `401 Unauthorized` - API 密钥无效
     - `429 Too Many Requests` - 超出速率限制
     - `insufficient_quota` - 额度不足

### 问题：模型选择后没有生效
**解决方案：**
- 刷新 YouTube 页面
- 重新加载扩展
- 清除浏览器缓存

### 问题：视频没有字幕
**解决方案：**
- 确保视频有字幕（自动生成或上传的）
- 部分视频可能禁用了字幕提取
- 尝试切换到其他语言的字幕

## 📊 调试技巧

### 查看详细日志
1. 打开 Chrome DevTools (F12)
2. 切换到 **Console** 标签
3. 发送消息时观察输出：
   - `Creating Chat Completion with model: xxx` - 正在调用 API
   - `Messages sent to OpenAI` - 发送的消息内容
   - `Return port.data.message` - 接收到的响应

### 检查后台脚本
1. 访问 `chrome://extensions/`
2. 找到 YouTube AI 扩展
3. 点击 **Service Worker** 或 **背景页**
4. 查看后台脚本的控制台输出

## 💡 最佳实践

### 选择合适的模型
- **日常使用**: GPT-4o Mini（快速、便宜）
- **复杂问题**: GPT-4o 或 GPT-4 Turbo
- **测试**: GPT-3.5 Turbo（最便宜）

### 节省 API 成本
- 使用 GPT-4o Mini 作为默认模型
- 只在需要时切换到更强大的模型
- 避免重复生成摘要

### 获得更好的回答
- 提问要具体明确
- 可以询问视频的特定部分
- 可以要求以特定格式回答

## 🔄 开发模式（可选）

如果你想修改扩展代码：

```powershell
# 启动开发服务器（自动重新加载）
pnpm run dev

# 加载 build/chrome-mv3-dev 目录到 Chrome
```

## 📝 更新日志

### 2025-11-25
- ✅ 修复 sharp 安装问题
- ✅ 更新模型列表到最新版本
- ✅ 添加 API 密钥验证
- ✅ 改进错误处理和日志
- ✅ 添加浏览器兼容性支持

## 🆘 需要帮助？

如果遇到问题：
1. 查看控制台日志（F12）
2. 检查本文档的故障排除部分
3. 确认 OpenAI API 密钥和额度
4. 查看 OpenAI API 状态：https://status.openai.com/

## 📄 相关链接

- [OpenAI API 文档](https://platform.openai.com/docs)
- [OpenAI API 密钥管理](https://platform.openai.com/api-keys)
- [OpenAI 使用情况](https://platform.openai.com/usage)
- [原始项目仓库](https://github.com/PaoloJN/youtube-ai-extension)
